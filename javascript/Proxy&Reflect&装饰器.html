<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Proxy&Reflect&装饰器 | VitePress</title>
    <meta name="description" content="Just playing around.">
    <link rel="preload stylesheet" href="/personal-website/assets/style.91ec3e89.css" as="style">
    <link rel="modulepreload" href="/personal-website/assets/app.7ff22c70.js">
    <link rel="modulepreload" href="/personal-website/assets/javascript_Proxy_Reflect_装饰器.md.2b305e72.lean.js">
    
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-93a960b4><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-93a960b4 data-v-0fa0e57d><div class="VPNavBar has-sidebar" data-v-0fa0e57d data-v-be450ad9><div class="container" data-v-be450ad9><div class="title" data-v-be450ad9><div class="VPNavBarTitle has-sidebar" data-v-be450ad9 data-v-6d2fb2d9><a class="title" href="/personal-website/" data-v-6d2fb2d9><!--[--><!--]--><!----><!--[-->momoyu<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-be450ad9><div class="curtain" data-v-be450ad9></div><div class="content-body" data-v-be450ad9><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-be450ad9 data-v-bdedfc22><span id="main-nav-aria-label" class="visually-hidden" data-v-bdedfc22>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/personal-website/interview/" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->面试<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/personal-website/algorithm/" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->数据结构和算法<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/personal-website/javascript/" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->JavaScript<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/personal-website/vue/" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->Vue<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/personal-website/react/" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->React<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/personal-website/sourcecode/" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->源码<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/personal-website/daily/" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->日常随笔<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/personal-website/other/" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->其他<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-be450ad9 data-v-da3f667a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-da3f667a data-v-0d529b6d data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-0d529b6d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-0d529b6d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-be450ad9 data-v-f38c483a data-v-96001b6b><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-96001b6b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-96001b6b><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-96001b6b><div class="VPMenu" data-v-96001b6b data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-f38c483a><div class="item appearance" data-v-f38c483a><p class="label" data-v-f38c483a>Appearance</p><div class="appearance-action" data-v-f38c483a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-f38c483a data-v-0d529b6d data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-0d529b6d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-0d529b6d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-be450ad9 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav" data-v-93a960b4 data-v-2817d72e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2817d72e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-2817d72e><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-2817d72e>Menu</span></button><a class="top-link" href="#" data-v-2817d72e>Return to top</a></div><aside class="VPSidebar" data-v-93a960b4 data-v-c79ccefa><div class="curtain" data-v-c79ccefa></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-c79ccefa><span class="visually-hidden" id="sidebar-aria-label" data-v-c79ccefa> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-c79ccefa><section class="VPSidebarItem level-0 has-active" data-v-c79ccefa data-v-b05232f3><div class="item" role="button" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link" data-v-b05232f3 data-v-30c06bd3><!--[--><h2 class="text" data-v-b05232f3>JavaScript</h2><!--]--><!----></a><!----></div><div class="items" data-v-b05232f3><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/personal-website/javascript/JS%E7%AC%94%E8%AE%B0.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>JS 笔记</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/personal-website/javascript/JS%E6%89%8B%E5%86%99%E9%A2%98.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>JS 手写题</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link is-active has-active" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/personal-website/javascript/Proxy&amp;Reflect&amp;%E8%A3%85%E9%A5%B0%E5%99%A8.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Proxy&Reflect&装饰器</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/personal-website/javascript/typescript.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>TypeScript</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-93a960b4 data-v-0bd490fb><div class="VPDoc has-sidebar has-aside" data-v-0bd490fb data-v-c5936a1e><div class="container" data-v-c5936a1e><div class="aside" data-v-c5936a1e><div class="aside-curtain" data-v-c5936a1e></div><div class="aside-container" data-v-c5936a1e><div class="aside-content" data-v-c5936a1e><div class="VPDocAside" data-v-c5936a1e data-v-cdc66372><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-cdc66372 data-v-5dd9d5f6><div class="content" data-v-5dd9d5f6><div class="outline-marker" data-v-5dd9d5f6></div><div class="outline-title" data-v-5dd9d5f6>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-5dd9d5f6><span class="visually-hidden" id="doc-outline-aria-label" data-v-5dd9d5f6> Table of Contents for current page </span><ul class="root" data-v-5dd9d5f6 data-v-1188541a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-cdc66372></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-c5936a1e><div class="content-container" data-v-c5936a1e><!--[--><!--]--><main class="main" data-v-c5936a1e><div style="position:relative;" class="vp-doc _personal-website_javascript_Proxy&amp;Reflect&amp;%E8%A3%85%E9%A5%B0%E5%99%A8" data-v-c5936a1e><div><h1 id="proxy-reflect-装饰器" tabindex="-1">Proxy&amp;Reflect&amp;装饰器 <a class="header-anchor" href="#proxy-reflect-装饰器" aria-hidden="true">#</a></h1><h1 id="proxy" tabindex="-1">Proxy <a class="header-anchor" href="#proxy" aria-hidden="true">#</a></h1><p><strong>代理</strong></p><p>Vue3使用proxy实现了真正的代理。</p><p>Vue2中，data中定义的变量，如果属性还是一个对象，初始化的时候就会递归的处理属性，收集依赖。</p><p>vue3中，当一个对象的属性还是一个对象时，只有在使用到它的时候，才会用proxy代理。</p><p><strong>Proxy是对对象的包装，将代理上的操作转发到对象，并可以选择捕获其中的一些操作。它可以包装任何类型的对象，包括类和函数。</strong></p><table><thead><tr><th>内部方法</th><th>Handler方法</th><th>何时触发</th></tr></thead><tbody><tr><td><code>[[Get]]</code></td><td>get</td><td>读取属性</td></tr><tr><td><code>[[Set]]</code></td><td>set</td><td>写入属性</td></tr><tr><td><code>[[HasProperty]]</code></td><td>has</td><td><code>in</code> 运算符</td></tr><tr><td><code>[[Delete]]</code></td><td>deleteProperty</td><td><code>delete</code> 操作</td></tr><tr><td><code>[[call]]</code></td><td>apply</td><td>proxy对象多为函数被调用</td></tr><tr><td><code>[[Construct]]</code></td><td>construct</td><td>new 操作</td></tr><tr><td><code>[[GetPrototypeOf]]</code></td><td>getPrototypeOf</td><td>Object.getPrototypeOf</td></tr><tr><td><code>[[SetPrototypeOf]]</code></td><td>setPrototypeOf</td><td>Object.setPrototypeOf</td></tr><tr><td><code>[[IsExtendsible]]</code></td><td>isExtendsible</td><td>Object.isExtendsible</td></tr><tr><td><code>[[PrebentExtensions]]</code></td><td>preventExtensions</td><td>Object.preventExtensions</td></tr><tr><td><code>[[DefineProperty]]</code></td><td>defineProperty</td><td>Object.defineProperty, Object.defineProperties</td></tr><tr><td><code>[[GetOwnProperty]]</code></td><td>getOwnPropertyDescriptor</td><td>Object.getOwnPropertyDescriptor, for...in, Object.keys/values/entries</td></tr><tr><td><code>[[OwnPropertyKeys]]</code></td><td>ownKeys</td><td>Object.getOwnPropertyName, Object.getOwnPropertySymbols, for...in, Object.keys/values/enteries</td></tr></tbody></table><p><strong>proxy的handler中没有钩子函数时，proxy就是target的一个透明代理。</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">let target = {};</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">let handler = {};</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">let proxy = new Proxy(target, handler);</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p><strong>一般我们用代理覆盖了变量。代理应该在所有地方完全替代了目标对象，目标对象被代理之后，任何人都不应该再引用目标对象。</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">let numbers = [1, 2, 3];</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">// 代理覆盖了变量。代理应该在所有地方都完全替代了目标对象，目标对象被代理之后，任何人都不应该再引用目标对象。</span></span>
<span class="line"><span style="color:#A6ACCD;">numbers = new Proxy(numbers, {</span></span>
<span class="line"><span style="color:#A6ACCD;">    get(target, key, receiver) {</span></span>
<span class="line"><span style="color:#A6ACCD;">         if (key in target) {</span></span>
<span class="line"><span style="color:#A6ACCD;">             return target[key];</span></span>
<span class="line"><span style="color:#A6ACCD;">         } else {</span></span>
<span class="line"><span style="color:#A6ACCD;">             return 0;</span></span>
<span class="line"><span style="color:#A6ACCD;">         }</span></span>
<span class="line"><span style="color:#A6ACCD;">     }</span></span>
<span class="line"><span style="color:#A6ACCD;"> })</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p><strong>set钩子中，成功写入属性要返回true，否则返回false，什么都返回会出现TypeError</strong></p><p><strong>Object.keys() for...in等方法，都使用了内部的 [[OwnPropertyKyes]]方法，这个内部方法，使用 <code>ownKeys</code> 钩子来拦截</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">/**</span></span>
<span class="line"><span style="color:#A6ACCD;"> * Object.keys()/Object.values() 返回带有enumerrable标记的非Symbol键值对</span></span>
<span class="line"><span style="color:#A6ACCD;"> * for...in 循环遍历所有带有 enumerable 标记的非 Symbol 键，以及原型对象的键</span></span>
<span class="line"><span style="color:#A6ACCD;"> * Object.getOwnPropertyNames(obj) 返回非 Symbol 键</span></span>
<span class="line"><span style="color:#A6ACCD;"> * Object.getOwnPropertySymbols(obj) 返回 symbol 键</span></span>
<span class="line"><span style="color:#A6ACCD;"> * **/</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">let user = {</span></span>
<span class="line"><span style="color:#A6ACCD;">    name: &#39;John&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">    age: 30,</span></span>
<span class="line"><span style="color:#A6ACCD;">    _password: &#39;***&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">user = new Proxy(user, {</span></span>
<span class="line"><span style="color:#A6ACCD;">    ownKeys(target) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        return Object.keys(target).filter(key =&gt; !key.startsWith(&#39;_&#39;));</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">for (let key in user) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    console.log(key);</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">console.log(Object.keys(user));</span></span>
<span class="line"><span style="color:#A6ACCD;">console.log(Object.values(user));</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">/**</span></span>
<span class="line"><span style="color:#A6ACCD;"> * Object.keys() 仅返回带有enumerable标记的属性，为了检查它，该方法会对每个属性调用[[GetOwnProperty]]  即 Object.getOwnPropertyDescriptor()</span></span>
<span class="line"><span style="color:#A6ACCD;"> * **/</span></span>
<span class="line"><span style="color:#A6ACCD;">let user = {};</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">user = new Proxy(user, {</span></span>
<span class="line"><span style="color:#A6ACCD;">    // 拦截内置方法 [[OwnPropertyKeys]]</span></span>
<span class="line"><span style="color:#A6ACCD;">    ownKeys(target) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        return [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span></span>
<span class="line"><span style="color:#A6ACCD;">    },</span></span>
<span class="line"><span style="color:#A6ACCD;">    // 拦截内置方法 [[GetOwnProperty]]</span></span>
<span class="line"><span style="color:#A6ACCD;">    // getOwnPropertyDescriptor(target, prop) {</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    // }</span></span>
<span class="line"><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">// 当user为空的时候，检测不到 enumerable 标记，这里返回的就是空</span></span>
<span class="line"><span style="color:#A6ACCD;">console.log(Object.keys(user)); // []</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">// 如果该属性不存在，我们只需要拦截 [[GetOwnProperty]] 即 getOwnPropertyDescriptor(target, prop)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">let user = {};</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">user = new Proxy(user, {</span></span>
<span class="line"><span style="color:#A6ACCD;">    // 拦截内置方法 [[OwnPropertyKeys]]</span></span>
<span class="line"><span style="color:#A6ACCD;">    ownKeys(target) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        return [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span></span>
<span class="line"><span style="color:#A6ACCD;">    },</span></span>
<span class="line"><span style="color:#A6ACCD;">    // 拦截内置方法 [[GetOwnProperty]]</span></span>
<span class="line"><span style="color:#A6ACCD;">    getOwnPropertyDescriptor(target, prop) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        // 为了实现 [[GetOwnProperty]] 方法调用时，返回enumerrable标记</span></span>
<span class="line"><span style="color:#A6ACCD;">        return {</span></span>
<span class="line"><span style="color:#A6ACCD;">            enumerable: true,</span></span>
<span class="line"><span style="color:#A6ACCD;">            configurable: true</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">console.log(Object.keys(user));</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p><strong>可撤销的代理</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">let user = {};</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">let { proxy, revoke } = Proxy.revocable(user, {});</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">// 调用revoke会从代理中删除对目标对象的所有内部引用</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h1 id="reflect" tabindex="-1">Reflect <a class="header-anchor" href="#reflect" aria-hidden="true">#</a></h1><p><strong>Reflect是一个内置对象，可简化的创建Proxy。</strong></p><p><strong>以前的内部方法 <code>[[Get]]</code> ， <code>[[Set]]</code> 都是规范，不能直接调用。Reflect使得调用这些方法称为可能，它的方法是内部方法的最小包装。</strong></p><p><strong>对于每一个可以被Proxy捕获到的内部方法。Reflect都有一个对应的方法，其名称和参数，和Proxy钩子相同，因此我们可以用Reflect将操作转发到原始对象。</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">let user = {</span></span>
<span class="line"><span style="color:#A6ACCD;">    name: &#39;John&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">user = new Proxy(user, {</span></span>
<span class="line"><span style="color:#A6ACCD;">    get(target, key, receiver) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        console.log(&#39;get&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">        // 使用Reflect将调用转发给对象</span></span>
<span class="line"><span style="color:#A6ACCD;">        return Reflect.get(target, key, receiver);</span></span>
<span class="line"><span style="color:#A6ACCD;">    },</span></span>
<span class="line"><span style="color:#A6ACCD;">    set(target, key, value, receiver) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        console.log(&#39;set&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">        return Reflect.set(target, key, value, receiver);</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">console.log(user.name);</span></span>
<span class="line"><span style="color:#A6ACCD;">user.name = &#39;test&#39;;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h1 id="装饰器" tabindex="-1">装饰器 <a class="header-anchor" href="#装饰器" aria-hidden="true">#</a></h1><p>装饰器是一种函数，用于注释或修改类、类方法。写法是 <code>@+函数名</code> 。</p><p>除了注释，装饰器还可以用来类型检查。</p><p><strong>装饰器对类行为的改变，是代码编译时发生的，而不是在运行时，本质是在编译时执行的函数。</strong></p><p><strong>如果同一个方法有多个装饰器，就会像剥洋葱一样，先从外到内进入，然后由内到外执行。</strong></p><p>装饰器也可以传参进去的。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">@testProps(&#39;name&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>装饰器主要用于：</p><ul><li><p>装饰类</p><ul><li></li></ul></li></ul><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">    @annotation</span></span>
<span class="line"><span style="color:#A6ACCD;">    class MyClass {}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    function annotation(target) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    	// 相当于给类加上了一个静态属性</span></span>
<span class="line"><span style="color:#A6ACCD;">    	target.annotation = true;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    // 等同于</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    class A {}</span></span>
<span class="line"><span style="color:#A6ACCD;">    A = decorator(A) || A</span></span>
<span class="line"><span style="color:#A6ACCD;">    ```</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">* 装饰方法或属性</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  + `target`：类的原型对象</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  + `name`：所要装饰的属性名</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  + `descriptor`：该属性的描述对象</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  - </span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><pre><code>class MyClass {
	@readonly
	method() {
	
	}
}

function readonly(target, name, descriptor) {

	// descriptor对象原来的值如下，我们 可以改动里面的内容，再返回
    // {
    //     value: specifiedFunction,
    //     enumerable: false,
    //     configurable: true,
    //     writeable: true,
    // }

	descriptor.writable = false;
	return descriptor;
}

function log(target, name, descriptor) {
    const oldValue = descriptor.value;
    descriptor.value = function() {
        return oldValue.apply(this, arguments); // olaValue.apply(this, arguments)  在这里调用被装饰的方法。
    }
}
```
</code></pre><p><strong>为什么装饰器不能用于函数？</strong></p><p>--因为存在函数提升。类不存在提升，所以装饰器可以用于类和类的方法</p><p><strong>装饰器的优点：</strong></p><ul><li><p>不需要通过创建子类的方式去扩展功能，避免代码的臃肿。</p></li><li><p>装饰类的方法复用性高。</p></li><li><p>不会影响原对象的代码结构。</p></li></ul><p><strong>装饰器在Vue中的应用：</strong></p><p>实际业务中，常常会把功能性代码和业务性代码耦合在一起，可以将功能性代码抽离出去，作为装饰器来装饰业务功能。</p><ul><li>**@Validate：**表单校验的逻辑抽离</li><li>**@catchError：**try...catch逻辑的抽离</li></ul></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-c5936a1e data-v-e033cd21><!----><div class="prev-next" data-v-e033cd21><div class="pager" data-v-e033cd21><a class="pager-link prev" href="/personal-website/javascript/JS%E6%89%8B%E5%86%99%E9%A2%98.html" data-v-e033cd21><span class="desc" data-v-e033cd21>Previous page</span><span class="title" data-v-e033cd21>JS 手写题</span></a></div><div class="has-prev pager" data-v-e033cd21><a class="pager-link next" href="/personal-website/javascript/typescript.html" data-v-e033cd21><span class="desc" data-v-e033cd21>Next page</span><span class="title" data-v-e033cd21>TypeScript</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"javascript_js笔记.md\":\"ff1b960d\",\"javascript_index.md\":\"41a4d0da\",\"other_yaml.md\":\"3fa46184\",\"javascript_proxy_reflect_装饰器.md\":\"2b305e72\",\"javascript_typescript.md\":\"91707cfd\",\"algorithm_index.md\":\"351e708d\",\"algorithm_introduction.md\":\"0d7968c7\",\"vue_vueclasscomponent.md\":\"46189d28\",\"daily_index.md\":\"347627f3\",\"index.md\":\"b3ef4493\",\"interview_company_company3.md\":\"ff629a7e\",\"interview_company_company4.md\":\"50fb67a6\",\"interview_index.md\":\"d9d2c65f\",\"interview_module.md\":\"12317916\",\"other_git.md\":\"dfb7edf4\",\"other_github-actions.md\":\"a8405d8f\",\"other_index.md\":\"38b4d4af\",\"other_package.json中的script.md\":\"385b2432\",\"other_webpack.md\":\"740c624d\",\"react_index.md\":\"82dc4084\",\"sourcecode_index.md\":\"f41b5d9c\",\"sourcecode_vue是如何发布的.md\":\"c06074c9\",\"vue_index.md\":\"2697b5fb\",\"vue_vue3学习笔记_note1.md\":\"0a5f29a9\",\"vue_vue3学习笔记_note10.md\":\"fc1d9dc3\",\"vue_vue3学习笔记_note11.md\":\"57276288\",\"vue_vue3学习笔记_note2.md\":\"d741fa50\",\"vue_vue3学习笔记_note3.md\":\"ec1201e9\",\"vue_vue3学习笔记_note4.md\":\"158f380a\",\"vue_vue3学习笔记_note5.md\":\"08b69084\",\"vue_vue3学习笔记_note6.md\":\"8a0c7a35\",\"vue_vue3学习笔记_note7.md\":\"9cb7ea5c\",\"vue_vue3学习笔记_note8.md\":\"298a5056\",\"vue_vue3学习笔记_note9.md\":\"cac0a5ac\",\"javascript_js手写题.md\":\"47b4e23a\",\"algorithm_note.md\":\"ce144c43\",\"interview_company_company1.md\":\"8c76c25f\",\"interview_company_company2.md\":\"4e38f1bd\"}")</script>
    <script type="module" async src="/personal-website/assets/app.7ff22c70.js"></script>
    
  </body>
</html>