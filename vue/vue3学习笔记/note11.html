<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>编译原理 - compiler | VitePress</title>
    <meta name="description" content="Just playing around.">
    <link rel="preload stylesheet" href="/personal-website/assets/style.91ec3e89.css" as="style">
    <link rel="modulepreload" href="/personal-website/assets/app.fc8d6d98.js">
    <link rel="modulepreload" href="/personal-website/assets/vue_vue3学习笔记_note11.md.8d384991.lean.js">
    
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-93a960b4><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-93a960b4 data-v-0fa0e57d><div class="VPNavBar has-sidebar" data-v-0fa0e57d data-v-be450ad9><div class="container" data-v-be450ad9><div class="title" data-v-be450ad9><div class="VPNavBarTitle has-sidebar" data-v-be450ad9 data-v-6d2fb2d9><a class="title" href="/personal-website/" data-v-6d2fb2d9><!--[--><!--]--><!----><!--[-->momoyu<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-be450ad9><div class="curtain" data-v-be450ad9></div><div class="content-body" data-v-be450ad9><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-be450ad9 data-v-bdedfc22><span id="main-nav-aria-label" class="visually-hidden" data-v-bdedfc22>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/personal-website/interview/" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->面试<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/personal-website/algorithm/" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->数据结构和算法<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/personal-website/javascript/" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->JavaScript<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/personal-website/vue/" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->Vue<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/personal-website/react/" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->React<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/personal-website/sourcecode/" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->源码<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/personal-website/daily/" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->日常随笔<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/personal-website/other/" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->其他<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-be450ad9 data-v-da3f667a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-da3f667a data-v-0d529b6d data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-0d529b6d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-0d529b6d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-be450ad9 data-v-f38c483a data-v-96001b6b><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-96001b6b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-96001b6b><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-96001b6b><div class="VPMenu" data-v-96001b6b data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-f38c483a><div class="item appearance" data-v-f38c483a><p class="label" data-v-f38c483a>Appearance</p><div class="appearance-action" data-v-f38c483a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-f38c483a data-v-0d529b6d data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-0d529b6d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-0d529b6d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-be450ad9 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav" data-v-93a960b4 data-v-2817d72e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2817d72e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-2817d72e><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-2817d72e>Menu</span></button><a class="top-link" href="#" data-v-2817d72e>Return to top</a></div><aside class="VPSidebar" data-v-93a960b4 data-v-c79ccefa><div class="curtain" data-v-c79ccefa></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-c79ccefa><span class="visually-hidden" id="sidebar-aria-label" data-v-c79ccefa> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-c79ccefa><section class="VPSidebarItem level-0 has-active" data-v-c79ccefa data-v-b05232f3><div class="item" role="button" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link" data-v-b05232f3 data-v-30c06bd3><!--[--><h2 class="text" data-v-b05232f3>Vue</h2><!--]--><!----></a><!----></div><div class="items" data-v-b05232f3><!--[--><section class="VPSidebarItem level-1 collapsible has-active" data-v-b05232f3 data-v-b05232f3><div class="item" role="button" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link" data-v-b05232f3 data-v-30c06bd3><!--[--><h3 class="text" data-v-b05232f3>vue3 学习笔记</h3><!--]--><!----></a><div class="caret" role="button" data-v-b05232f3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-b05232f3><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-b05232f3><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/personal-website/vue/vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/note1.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>笔记一</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/personal-website/vue/vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/note2.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>笔记二</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/personal-website/vue/vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/note3.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>笔记三</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/personal-website/vue/vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/note4.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>笔记四</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/personal-website/vue/vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/note5.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>笔记五</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/personal-website/vue/vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/note6.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>笔记六</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/personal-website/vue/vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/note7.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>笔记七</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/personal-website/vue/vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/note8.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>笔记八</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/personal-website/vue/vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/note9.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>笔记九</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/personal-website/vue/vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/note10.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>笔记十</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link is-active has-active" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/personal-website/vue/vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/note11.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>笔记十一</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/personal-website/vue/vueClassComponent.html" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>vue-class-component</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-93a960b4 data-v-0bd490fb><div class="VPDoc has-sidebar has-aside" data-v-0bd490fb data-v-c5936a1e><div class="container" data-v-c5936a1e><div class="aside" data-v-c5936a1e><div class="aside-curtain" data-v-c5936a1e></div><div class="aside-container" data-v-c5936a1e><div class="aside-content" data-v-c5936a1e><div class="VPDocAside" data-v-c5936a1e data-v-cdc66372><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-cdc66372 data-v-5dd9d5f6><div class="content" data-v-5dd9d5f6><div class="outline-marker" data-v-5dd9d5f6></div><div class="outline-title" data-v-5dd9d5f6>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-5dd9d5f6><span class="visually-hidden" id="doc-outline-aria-label" data-v-5dd9d5f6> Table of Contents for current page </span><ul class="root" data-v-5dd9d5f6 data-v-1188541a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-cdc66372></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-c5936a1e><div class="content-container" data-v-c5936a1e><!--[--><!--]--><main class="main" data-v-c5936a1e><div style="position:relative;" class="vp-doc _personal-website_vue_vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0_note11" data-v-c5936a1e><div><h1 id="编译原理-compiler" tabindex="-1">编译原理 - compiler <a class="header-anchor" href="#编译原理-compiler" aria-hidden="true">#</a></h1><p>Vue中，组件都是以虚拟DOM的形式存在，加载完毕之后注册effect函数。</p><p>组件内部数据变化之后，用vue的响应式机制做到了通知组件更新。</p><p>内部使用patch函数实现了虚拟DOM的更新（中间包括了位运算、最长递增子序列等）</p><p><a href="https://vue-next-template-explorer.netlify.app/#eyJzcmMiOiI8ZGl2IGlkPVwiYXBwXCI+XG4gICAgPGRpdiBAY2xpY2s9XCIoKT0+Y29uc29sZS5sb2coeHgpXCIgOmlkPVwibmFtZVwiPnt7bmFtZX19PC9kaXY+XG4gICAgPGgxIDpuYW1lPVwidGl0bGVcIj7njqnovax2dWUzPC9oMT5cbiAgICA8cCA+57yW6K+R5Y6f55CGPC9wPlxuPC9kaXY+XG4iLCJzc3IiOmZhbHNlLCJvcHRpb25zIjp7ImhvaXN0U3RhdGljIjp0cnVlLCJjYWNoZUhhbmRsZXJzIjp0cnVlLCJvcHRpbWl6ZUJpbmRpbmdzIjpmYWxzZX19" target="_blank" rel="noreferrer">vue编译在线演示</a></p><p>Vue的compiler实现了template到render函数的转变</p><h2 id="整体流程" tabindex="-1">整体流程 <a class="header-anchor" href="#整体流程" aria-hidden="true">#</a></h2><ul><li>代码会被解析成一个对象（类似于虚拟DOM的对象，描述template的代码关系） -- 抽象语法树（简称ATS）</li><li>transform模块对代码进行优化</li><li>generate模块最终生成render函数</li><li>即：<strong>template -- 词法分析 -- 语法分析（tokenziner函数） -- AST（parse函数） -- transform模块（transform函数 -- travese函数，标记静态节点） -- generate模块（generate函数 -- 遍历AST，拼接最后要执行的函数字符串） -- render函数</strong></li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">compiler</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">templte</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ast</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">template</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">transform</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ast</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">generate</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ast</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> template </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">&lt;div id=&quot;app&quot;&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">        &lt;div @click=&quot;()=&gt;console.log(xx)&quot; :id=&quot;name&quot;&gt;{{name}}&lt;/div&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">        &lt;h1 :name=&quot;title&quot;&gt;玩转vue3&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">        &lt;p &gt;编译原理&lt;/p&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">    &lt;/div&gt;</span><span style="color:#89DDFF;">`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> renderFunction </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">compiler</span><span style="color:#A6ACCD;">(template)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(renderFunction)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="具体实现" tabindex="-1">具体实现 <a class="header-anchor" href="#具体实现" aria-hidden="true">#</a></h2><h3 id="tokenizer" tabindex="-1">tokenizer <a class="header-anchor" href="#tokenizer" aria-hidden="true">#</a></h3><ul><li>词法分析，将 <code>&lt;div&gt;</code> <code>@click</code> <code></code>等语法识别出来，转换成一个个的token。可以理解为把template的语法进行了分类，这一步就叫tokenizer</li><li>tokens数组存储解析的结果，对模板字符串进行循环 -- <code>&lt; &gt; / 空格</code> -- 字符串中的关键分隔符</li><li>push方法将分割后的token存储在数组tokens中</li></ul><h3 id="生成抽象语法树-ast" tabindex="-1">生成抽象语法树 AST <a class="header-anchor" href="#生成抽象语法树-ast" aria-hidden="true">#</a></h3><p>根据tokenziner函数的返回值数组，按照标签的嵌套关系转换成树形结构 -- parse函数</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">  { type: &#39;tagstart&#39;, val: &#39;div&#39; },</span></span>
<span class="line"><span style="color:#A6ACCD;">  { type: &#39;props&#39;, val: &#39;id=&quot;app&quot;&#39; },</span></span>
<span class="line"><span style="color:#A6ACCD;">  { type: &#39;tagstart&#39;, val: &#39;div&#39; },</span></span>
<span class="line"><span style="color:#A6ACCD;">  { type: &#39;props&#39;, val: &#39;@click=&quot;()=console.log(xx)&quot;&#39; },</span></span>
<span class="line"><span style="color:#A6ACCD;">  { type: &#39;props&#39;, val: &#39;:id=&quot;name&quot;&#39; },</span></span>
<span class="line"><span style="color:#A6ACCD;">  { type: &#39;text&#39;, val: &#39;{{name}}&#39; },</span></span>
<span class="line"><span style="color:#A6ACCD;">  { type: &#39;tagend&#39;, val: &#39;div&#39; },</span></span>
<span class="line"><span style="color:#A6ACCD;">  { type: &#39;tagstart&#39;, val: &#39;h1&#39; },</span></span>
<span class="line"><span style="color:#A6ACCD;">  { type: &#39;props&#39;, val: &#39;:name=&quot;title&quot;&#39; },</span></span>
<span class="line"><span style="color:#A6ACCD;">  { type: &#39;text&#39;, val: &#39;玩转vue3&#39; },</span></span>
<span class="line"><span style="color:#A6ACCD;">  { type: &#39;tagend&#39;, val: &#39;h1&#39; },</span></span>
<span class="line"><span style="color:#A6ACCD;">  { type: &#39;tagstart&#39;, val: &#39;p&#39; },</span></span>
<span class="line"><span style="color:#A6ACCD;">  { type: &#39;text&#39;, val: &#39;编译原理&#39; },</span></span>
<span class="line"><span style="color:#A6ACCD;">  { type: &#39;tagend&#39;, val: &#39;p&#39; },</span></span>
<span class="line"><span style="color:#A6ACCD;">  { type: &#39;tagend&#39;, val: &#39;div&#39; }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><ul><li>首先使用一个ast对象作为根节点</li></ul><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">    let ast = {</span></span>
<span class="line"><span style="color:#A6ACCD;">        type: &#39;root&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">        props: [],</span></span>
<span class="line"><span style="color:#A6ACCD;">        children: []</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><ul><li>walk函数遍历整个tokens数组，根据token的类型不同，生成不同的node对象</li><li>根据tagend的状态来决定walk的递归逻辑</li></ul><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">props</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[],</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">children</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">element</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">tag</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">div</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">props</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">key</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">val</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\&quot;</span><span style="color:#C3E88D;">app</span><span style="color:#A6ACCD;">\&quot;</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">children</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">element</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">tag</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">div</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">props</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@click</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">val</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\&quot;</span><span style="color:#C3E88D;">()</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">val</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#A6ACCD;">\&quot;</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">children</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">val</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{{name}}</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">element</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">tag</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">h1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">props</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">val</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\&quot;</span><span style="color:#C3E88D;">title</span><span style="color:#A6ACCD;">\&quot;</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">children</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">val</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">玩转vue3</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">element</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">tag</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">p</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">props</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[],</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">children</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">val</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">编译原理</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="语义分析和优化" tabindex="-1">语义分析和优化 <a class="header-anchor" href="#语义分析和优化" aria-hidden="true">#</a></h3><p><strong>transform函数</strong></p><p>transform函数实现语义的分析和优化。理解Vue中的语法，并为最后的生成代码做准备。</p><p>traverse函数递归整个AST，并且在这一步实现简单的静态标记。</p><p>当节点标记为 <code>element</code> ，默认使用 <code>ast.flag</code> 标记节点的动态状态。</p><p>如果属性是 <code>@</code> 开头的，就认为它是Vue中的事件绑定，使用 <code>arg.flag |= PatchFlags.EVENT</code> 标记当前节点的事件是动态的。</p><p><code>冒号</code> 开头的就是动态的属性，并且把class和style标记了不同的flag。</p><p>如果都没有命中的话，就使用 <code>static:true</code> ，标记当前节点是静态节点</p><p><strong>generate函数</strong> walk函数遍历整个AST，拼接成最后要执行的函数字符串。</p><p>遍历过程中，会收集依赖</p><p>最后在createVNode函数的最后 一个参数带上ast.flag进行状态的标记。</p><p>最终生成了目标代码render函数，这个函数最终会和组件的setup函数一起组成运行时的组件对象。</p><p><strong>vue的compiler输出的代码会有几个hoisted开头的变量，这些变量是用于静态节点提升，就是在整个生命周期中只需要进行一次创建，有效节省不必要的性能开销</strong></p><h2 id="vue-compiler入口" tabindex="-1">vue compiler入口 <a class="header-anchor" href="#vue-compiler入口" aria-hidden="true">#</a></h2><ul><li>四个和compiler相关的包 <ul><li>compiler-core：浏览器端的编译（需深入研究）。实际使用的方法是core提供的</li><li>compiler-dom：浏览器端的编译（需深入研究）。负责传入浏览器DOM相关的API</li><li>compiler-ssr：服务端渲染</li><li>compiler-sfc：编译.vue单文件的</li></ul></li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">compiler</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">template</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">options</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">CompilerOptions</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">CodegenResult</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">baseCompiler</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">template</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">extend</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{},</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">parseOptions</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            nodeTransforms</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">ignoreSideEffectTags</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">DOMNodeTransforms</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">...</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">nodeTransforms</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">            ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            directiveTransforms</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">extend</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">DOMDirectiveTransforms</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">directiveTransforms</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#F07178;">            )</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            transformHoist</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">__BROWSER__</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stringifyStatic</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="compiler-dom" tabindex="-1">compiler-dom <a class="header-anchor" href="#compiler-dom" aria-hidden="true">#</a></h3><p>负责传入浏览器Dom相关的配置。</p><ul><li>baseCompiler: <ul><li>parseOptions中的isNativeTag区分了element和component。内部把所有的html标签存储在一个对象中，用于对比是不是浏览器自带的element。</li></ul></li></ul><h2 id="vue浏览器端编译的核心流程" tabindex="-1">Vue浏览器端编译的核心流程 <a class="header-anchor" href="#vue浏览器端编译的核心流程" aria-hidden="true">#</a></h2><ul><li>baseCompiler函数，是vue浏览器端编译的核心流程 <ul><li>baseParse -- <strong>createPaseContext</strong><ul><li>parseInterpolation负责标识变量的分隔符</li><li>parseTextData获取变量的值，并且通过innerStart和innerEnd去记录插值的位置</li><li>parseText处理模板中的普通文本，主要是把文本包裹成AST对象。</li><li>parseElement <ul><li>首先判断pre和v-pre标签，</li><li>然后通过isVoidtag判断 标签是否是自闭和</li><li>递归调用parseChidlren，再解析开始标签、子节点，最终解析结束标签</li><li>parseTag解析节点 <ul><li>parseAttribute处理属性，对pre和v-pre标签进行检查</li><li>isComponent判断是否为组件 <ul><li>通过isNativeTag辅助判断，最终返回一个描述节点的对象，包含当前节点所有解析之后的信息，tag - 标签名，children - 子节点的数组</li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><h2 id="ast的语义化分析" tabindex="-1">AST的语义化分析 <a class="header-anchor" href="#ast的语义化分析" aria-hidden="true">#</a></h2><p>transform函数的核心逻辑就是识别一个个的Vue语法，并且进行编译器的优化，我们常提到的静态标记就是这一步完成的。</p><p><strong>createTransformContext</strong></p><ul><li>transform <ul><li>traverseNode函数，可编译AST所有的节点。内部通过nodetype来具体执行不同的函数</li><li>tranformElement函数，转换节点，用来处理props和children的静态标记</li><li>transformText函数转换文本</li><li>transformIf：v-if的语法转换</li><li>transformFor：v-for的语法转换</li><li>transformOn：v-on的语法转换</li><li>transformModel：v-model的语法转换</li></ul></li></ul><h2 id="template到render函数的转化" tabindex="-1">template到render函数的转化 <a class="header-anchor" href="#template到render函数的转化" aria-hidden="true">#</a></h2><p>generate函数，首先通过 createCodegenContext 创建上下文对象，然后通过 genModulePreamble 生成预先定义好的代码模板，然后生成 render 函数，最后生成创建虚拟 DOM 的表达式</p><p><strong>createCodegenContext</strong></p><ul><li>generate函数 <ul><li>genModulePreamble：生成预先定义好的代码模板，生成import风格的代码</li><li>genNode：生成创建虚拟DOM的代码，针对变量、标签、v-if等等有不同的代码生成逻辑</li></ul></li></ul><h2 id="编译原理带来的好处" tabindex="-1">编译原理带来的好处 <a class="header-anchor" href="#编译原理带来的好处" aria-hidden="true">#</a></h2><h3 id="vite插件" tabindex="-1">vite插件 <a class="header-anchor" href="#vite插件" aria-hidden="true">#</a></h3><p>利用编译原理的思想，通过正则匹配的方式，完全可以分析出来当前组件依赖的API有哪些，这样就可以在组件执行之前自动导入这些API。</p><p><a href="https://github.com/antfu/unplugin-auto-import" target="_blank" rel="noreferrer">auto-import</a></p><p><a href="https://cn.vitejs.dev/guide/api-plugin.html" target="_blank" rel="noreferrer">vite插件开发文档</a></p><h3 id="babel" tabindex="-1">Babel <a class="header-anchor" href="#babel" aria-hidden="true">#</a></h3><p>编译原理思想，代码转换自动处理 <code>async</code> <code>await</code> ，以及 <code>try...catch</code></p><ul><li>babel提供了完整的代码解析的能力，包括AST的解析，语义分析，代码生成等。 <ul><li>@babel/parse：提供了代码解析的能力，能够把js代码解析成AST，代码就从字符串变成树形结构</li><li>@babel/traverse：提供了遍历AST的能力，可以从traverse中获取每一个节点的信息去修改它</li><li>@babel/types：提供了类型判断的函数，方便的判断每一个节点的类型</li><li>@babel/core：提供了代码转换的能力</li></ul></li></ul><h1 id="vite原理" tabindex="-1">vite原理 <a class="header-anchor" href="#vite原理" aria-hidden="true">#</a></h1><h2 id="webpack" tabindex="-1">webpack <a class="header-anchor" href="#webpack" aria-hidden="true">#</a></h2><p>webpack的核心原理就是通过分析JavaScript中的require语句，分析出当前JavaScript文件所有的依赖文件，然后递归分析之后，就得到了整个项目的一个依赖图。对依赖图中不同的文件执行不同loader，比如会把css文件解析成加载CSS标签的JavaScript，最后基于这个依赖图获取所有的文件。</p><p>进行打包处理之后，放在内存中提供给浏览器使用，然后dev-server会启动一个测试服务器打开页面，并且在代码文件修改之后，可以通过 <code>WebSocket</code> 的方式通知前端自动更新页面，也就是我们熟悉的热更新功能。</p><p>webpack项目调试之前，要把所有的文件依赖关系收集完，打包处理后才能启动测试，对开发效率方面就会产生一定的影响。针对webpack这种bundle的思路，社区就诞生了bundless的框架，vite就是其中之一。</p><p>前端项目之所以需要打包，是因为浏览器里的JavaScript没有很好的方式去引入其他文件，webpack 提供的打包功能可以帮助我们更好地组织开发代码，但是现在大部分浏览器都支持了 ES6 的 module 功能，我们在浏览器内使用 type=&quot;module&quot;标记一个 script 后，在 src/main.js 中就可以直接使用 import 语法去引入一个新的 JavaScript 文件。这样我们其实可以不依赖 webpack 的打包功能，利用浏览器的 module 功能就可以重新组织我们的代码。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">// 目前浏览器可以支持这样的写法</span></span>
<span class="line"><span style="color:#A6ACCD;">&lt;script type=&quot;module&quot; src=&quot;/src/main.js&quot;&gt;&lt;/script&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="vite原理-1" tabindex="-1">vite原理 <a class="header-anchor" href="#vite原理-1" aria-hidden="true">#</a></h2><ul><li>浏览器的module功能：浏览器识别出JavaScript中的import语句之后，会发起一个新的网络请求去获取新的文件，所以只支持<code>/</code>, <code>./</code>, <code>../</code>开头的路径</li><li>对CSS的解析，如果url是.css结尾的，就返回一段JavaScript代码，这段JavaScript会再浏览器内创建一个style标签，标签内部放入我们读取的CSS文件代码</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (url</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">endsWith</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.css</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">p</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">__dirname</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">slice</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">file</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFileSync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">p</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">`</span></span>
<span class="line"><span style="color:#C3E88D;">            const css = &quot;</span><span style="color:#89DDFF;">${</span><span style="color:#A6ACCD;">file</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">\n</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">g</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&quot;</span></span>
<span class="line"><span style="color:#C3E88D;">            let link = document.createElement(&#39;style&#39;)</span></span>
<span class="line"><span style="color:#C3E88D;">            link.setAttribute(&#39;type&#39;, &#39;text/css&#39;)</span></span>
<span class="line"><span style="color:#C3E88D;">            document.head.appendChild(link)</span></span>
<span class="line"><span style="color:#C3E88D;">            link.innerHTML = css</span></span>
<span class="line"><span style="color:#C3E88D;">            export default css</span></span>
<span class="line"><span style="color:#C3E88D;">            </span><span style="color:#89DDFF;">`</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">type</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">application/javascript</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">content</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><ul><li><p>热更新实现：在客户端注入一个额外的JavaScript文件，这个文件用来和后端实现<code>websocket</code>通信</p></li><li><p>webpack启动服务器之前需要进行项目的打包，vite则是直接启动服务，通过浏览器运行时的请求拦截，实现首页文件的按需加载，实现开发服务器启动的时间和整个项目的复杂度解耦。</p></li><li><p>vite的主要目的是提供一个调试服务器，vite也可以和Vue解耦，实现对任何框架的支持，只需要使用对应框架的vite插件就可以支持任意框架。</p></li><li><p>vite能够这么快，还有一个原因就是使用了esbuild去解析JavaScript文件</p></li></ul><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">01.  请求 首页http://xxx.xxx.xxx/ </span></span>
<span class="line"><span style="color:#A6ACCD;">02.  返回 index.html</span></span>
<span class="line"><span style="color:#A6ACCD;">03.  请求 /src/main.js</span></span>
<span class="line"><span style="color:#A6ACCD;">04. 发现请求js文件，替换路径为相对路径后，返回修改后的js文件</span></span>
<span class="line"><span style="color:#A6ACCD;">05.  请求 @module/vue</span></span>
<span class="line"><span style="color:#A6ACCD;">06.  发现请求@module内的文件，替换文件内为相对路径后，返回package.json中module定义的入口文件</span></span>
<span class="line"><span style="color:#A6ACCD;">07.  请求 ./App.vue</span></span>
<span class="line"><span style="color:#A6ACCD;">08.  判断 .vue 的请求后，通过 compilerSFC.parse解析 Vue 组件，通过返回的 descriptor.script 获取 js 代码</span></span>
<span class="line"><span style="color:#A6ACCD;">09.  请求 ./App.vue?type=template</span></span>
<span class="line"><span style="color:#A6ACCD;">10.  调用 compilerDom.compile 解析 template 内容，直接返回 render 函数</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p><a href="https://github.com/shengxinjing/geektime-vue-course/tree/main/vite-mini" target="_blank" rel="noreferrer">mini-vite源码</a></p><h1 id="数据流原理-vuex-pinia" tabindex="-1">数据流原理 Vuex &amp; Pinia <a class="header-anchor" href="#数据流原理-vuex-pinia" aria-hidden="true">#</a></h1><h2 id="vuex5" tabindex="-1">vuex5 <a class="header-anchor" href="#vuex5" aria-hidden="true">#</a></h2><ul><li>支持compositionAPI和OptionAPI</li><li>去掉了namespace模式</li><li>使用组合store的方式更好的支持了ts的类型推导</li><li>去掉了容易混淆的<code>mutation``action</code>概念，只保留了<code>action</code></li><li>支持自动的代码切割</li></ul><h2 id="pinia-未来的vuex" tabindex="-1">pinia - 未来的vuex <a class="header-anchor" href="#pinia-未来的vuex" aria-hidden="true">#</a></h2><ul><li><p><a href="https://pinia.vuejs.org/" target="_blank" rel="noreferrer">pinia地址</a></p></li><li><p>安装： <code>npm install pinia@next</code></p></li><li><p>导入： <code>import { createPinia } from pinia</code></p></li><li><p>使用： <code>const pinia = createPinia(); app.use(pinia)</code></p></li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 定义count</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">defineStore</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pinia</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> useCounterStore </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineStore</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">count</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">id</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">count</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">state</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                count</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">actions</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">add</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">count</span><span style="color:#89DDFF;">++;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 使用</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">useCounterStore</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../store/count</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> count </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">useCounterStore</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">add</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">count</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 触发actions，实现数据的修改</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// count.$patch({ count: count + 1 }) // 还可以通过调用内部方法的方式来更新store数据</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// composition方式定义count</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">defineStore</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pinia</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> useCounterStore </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineStore</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">count</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">count</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">ref</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">increment</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">count</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">++;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">count</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">increment</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="pinia源码" tabindex="-1">pinia源码 <a class="header-anchor" href="#pinia源码" aria-hidden="true">#</a></h2><ul><li><a href="https://github.com/vuejs/pinia" target="_blank" rel="noreferrer">pinia的github</a></li><li>createPinia函数 <ul><li>ref创建响应式数据对象<code>state</code></li><li><code>install</code>方法支持<code>app.use</code>的注册</li><li>内部通过<code>provide</code>的语法和全局<code>$pinia</code>配置pinia对象</li><li>use方法和toBeInstalled数组实现了Pinia的插件机制</li><li>pinia.use(devtoolsPlugin)实现了对VueDevtools的支持</li><li>pinia实例就是ref({})包裹的响应式对象，项目中用到的state都会挂载到Pinia这个响应式对象内部</li></ul></li><li>defineStore函数 <ul><li>useStore方法定义每一个store，每个store都会标记<code>唯一的id</code><ul><li>getCurrentInstance获取当前组件的实例，如果useStore参数没有Pinia的话，就会<code>inject</code>去获取Pinia的实例，<code>这里的inject就是createPinia方法中install方法提供的</code></li><li>setActivePinia函数</li><li>根据创建实例时使用composition还是option，使用<code>createSetupStore</code>或者<code>createOptionsStore</code></li></ul></li></ul></li></ul><h1 id="前端路由原理" tabindex="-1">前端路由原理 <a class="header-anchor" href="#前端路由原理" aria-hidden="true">#</a></h1><h2 id="入口分析" tabindex="-1">入口分析 <a class="header-anchor" href="#入口分析" aria-hidden="true">#</a></h2><p>createRouter方法创建路由，app.use加载vur-router插件，并且注册内置组件router-view、router-link</p><h2 id="路由安装-install方法" tabindex="-1">路由安装 - install方法 <a class="header-anchor" href="#路由安装-install方法" aria-hidden="true">#</a></h2><p>install方法内部注册了RouterLink和RouterView两个全局组件。</p><p>app.provide给全局注册了route和reactive包裹之后的reactiveRoute对象（provide提供的数据没有做响应式封装，需要响应式的时候需要自己使用ref或者reactive封装为响应式对象）</p><ul><li>router-view <ul><li>setup函数返回了routerview组件的render函数</li><li>直接使用<code>&lt;router-view/&gt;</code>，没有slot的情况下，返回的就是component变量。component变量使用h函数返回ViewComponent的虚拟DOM</li><li>ViewComponent根据matchedRoute.components[<a href="http://props.name" target="_blank" rel="noreferrer">props.name</a>]计算来的</li><li>matchedRoute最终来源于Router的install方法中注入的currentRoute对象</li></ul></li></ul><h2 id="路由更新" tabindex="-1">路由更新 <a class="header-anchor" href="#路由更新" aria-hidden="true">#</a></h2><p><strong>router-view渲染的组件是根据当前匹配的路由变量matchedRoute决定的</strong></p><ul><li>matcher的由来： <ul><li>createRouterMatcher方法，传入routes配置的路由数组，返回创建的RouterMatcher对象，内部遍历routes数组，通过addRoute挨个处理路由配置。</li></ul></li></ul><p><code>createWebHashHistory和createWebHistory</code> 方法内部，都是通过 <code>useHistoryListener</code> 实现路由的监听，通过 <code>useHistoryStateNavigation</code> 实现路由的切换。 <code>useHistoryStateNavigation</code> 会返回push和replace方法来更新路由。</p><h1 id="服务端渲染原理" tabindex="-1">服务端渲染原理 <a class="header-anchor" href="#服务端渲染原理" aria-hidden="true">#</a></h1><p>SSR- Server Side Rendering</p><h2 id="ssr" tabindex="-1">SSR <a class="header-anchor" href="#ssr" aria-hidden="true">#</a></h2><h3 id="为什么有ssr" tabindex="-1">为什么有SSR？ <a class="header-anchor" href="#为什么有ssr" aria-hidden="true">#</a></h3><p>MVVM盛行，Vue和React的全家桶都有框架的身影，所有页面的渲染流程也全部都是浏览器加载完JavaScript文件后，由JavaScript获取当前的路由地址，再决定渲染哪个页面。</p><ul><li>CSR - 客户端渲染： <ul><li>首页白屏时间可能过长。</li><li>搜索引擎爬虫抓取到页面数据，body还为空，不利于SEO</li></ul></li></ul><p>在用户访问页面的时候，能够把首页渲染的HTML内容写入到body内部，也就是说我们需要再服务端实现组件的渲染。</p><h3 id="如何实现ssr" tabindex="-1">如何实现SSR？ <a class="header-anchor" href="#如何实现ssr" aria-hidden="true">#</a></h3><ul><li>库：<code>@vue/server-renderer</code></li><li>创建文件夹vue-ssr</li><li>安装<code>server-renderer</code>, <code>vue</code>, <code>express</code></li><li>新建server.js</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        * 实现在服务端解析Vue的组件，直接把渲染结果返回给浏览器</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        * **/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> express </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> Vue </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> renderer3 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@vue/server-renderer</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> vue3Compile </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@vue/compiler-ssr</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">       </span><span style="color:#676E95;font-style:italic;">// vue组件</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> vueapp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">&lt;div&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">                &lt;h1 @click=&quot;add&quot;&gt;{{ num }}&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">                &lt;ul&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">                    &lt;li v-for=&quot;(todo, n) in todos&quot;&gt;{{ n + 1 }}--{{ todo }}&lt;/li&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">                &lt;/ul&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">            &lt;/div&gt;</span><span style="color:#89DDFF;">`</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">               </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                   num</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">                   todos</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">吃饭</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">睡觉</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">打豆豆</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">               </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">           </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#F07178;">methods</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">               </span><span style="color:#F07178;">add</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                   </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">num</span><span style="color:#89DDFF;">++;</span></span>
<span class="line"><span style="color:#F07178;">               </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">       </span><span style="color:#676E95;font-style:italic;">// 使用@vue/compiler-ssr解析template</span></span>
<span class="line"><span style="color:#A6ACCD;">       vueapp</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ssrRender </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Function</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">require</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> vue3Compile</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">compile</span><span style="color:#A6ACCD;">(vueapp</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">template)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">code)(require)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">       </span><span style="color:#676E95;font-style:italic;">// 路由首页返回结果</span></span>
<span class="line"><span style="color:#A6ACCD;">       app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">           </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">vapp</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Vue</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createSSRApp</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">vueapp</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">           </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">html</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">renderer3</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">renderToString</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">vapp</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">           </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">title</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Vue SSR</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">           </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ret</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">&lt;!DOCTYPE html&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">                            &lt;html lang=&quot;en&quot;&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">                                &lt;head&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">                                    &lt;meta charset=&quot;UTF-8&quot; /&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">                                    &lt;link rel=&quot;icon&quot; href=&quot;/favicon.ico&quot; /&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">                                    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">                                    &lt;title&gt;</span><span style="color:#89DDFF;">${</span><span style="color:#A6ACCD;">title</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&lt;/title&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">                                &lt;/head&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">                                &lt;body&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">                                    &lt;div id=&quot;app&quot;&gt;</span><span style="color:#89DDFF;">${</span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">                                &lt;/body&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">                            &lt;/html&gt;</span><span style="color:#89DDFF;">`</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">           </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ret</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">       </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">       app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">9093</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">           </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">listen 9093</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">       </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-c5936a1e data-v-e033cd21><!----><div class="prev-next" data-v-e033cd21><div class="pager" data-v-e033cd21><a class="pager-link prev" href="/personal-website/vue/vue3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/note10.html" data-v-e033cd21><span class="desc" data-v-e033cd21>Previous page</span><span class="title" data-v-e033cd21>笔记十</span></a></div><div class="has-prev pager" data-v-e033cd21><a class="pager-link next" href="/personal-website/vue/vueClassComponent.html" data-v-e033cd21><span class="desc" data-v-e033cd21>Next page</span><span class="title" data-v-e033cd21>vue-class-component</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"other_搭建静态资源服务.md\":\"e9bf7207\",\"algorithm_index.md\":\"9d42904b\",\"algorithm_introduction.md\":\"39b02236\",\"daily_index.md\":\"2af0f20d\",\"index.md\":\"bf49b89a\",\"interview_2024interview_html.md\":\"65f05592\",\"interview_2024interview_javascript.md\":\"da41e58b\",\"interview_2024interview_项目难点记录.md\":\"a2ce9bba\",\"interview_company_company1.md\":\"ed495a28\",\"sourcecode_index.md\":\"e52c50b9\",\"other_webpack.md\":\"9867bccd\",\"react_index.md\":\"8c502628\",\"interview_index.md\":\"e3cb8250\",\"vue_vue3学习笔记_note4.md\":\"5bd620de\",\"vue_vue3学习笔记_note6.md\":\"9957304e\",\"vue_vue3学习笔记_note8.md\":\"b441954f\",\"javascript_index.md\":\"1ba9201f\",\"vue_vueclasscomponent.md\":\"8a948faf\",\"vue_vue3学习笔记_note5.md\":\"f7a51b8a\",\"vue_vue3学习笔记_note3.md\":\"8a4352fd\",\"vue_index.md\":\"39802b65\",\"vue_vue3学习笔记_note1.md\":\"9cd95632\",\"javascript_proxy_reflect_装饰器.md\":\"57c2378f\",\"vue_vue3学习笔记_note11.md\":\"8d384991\",\"other_yaml.md\":\"7f25a454\",\"vue_vue3学习笔记_note10.md\":\"e1985427\",\"vue_vue3学习笔记_note2.md\":\"7f57a11a\",\"sourcecode_vue是如何发布的.md\":\"a8d065ac\",\"interview_company_company4.md\":\"537cc109\",\"interview_company_company2.md\":\"470d754e\",\"algorithm_note.md\":\"5b198236\",\"vue_vue3学习笔记_note7.md\":\"d51909e3\",\"interview_company_company3.md\":\"803182b7\",\"vue_vue3学习笔记_note9.md\":\"2a3d83b6\",\"interview_2024interview_css.md\":\"24d4ecff\",\"other_github-actions.md\":\"96ce604b\",\"other_index.md\":\"242cbe84\",\"other_package.json中的script.md\":\"2e7f62c0\",\"javascript_js手写题.md\":\"dcbabb02\",\"javascript_typescript.md\":\"2f0df9b9\",\"javascript_js笔记.md\":\"553d07ce\",\"other_git.md\":\"3dbc057d\",\"interview_module.md\":\"d1fe18d1\"}")</script>
    <script type="module" async src="/personal-website/assets/app.fc8d6d98.js"></script>
    
  </body>
</html>